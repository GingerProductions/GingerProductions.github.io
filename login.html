<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Spud Dashboard</title>
    <link rel="icon" type="image/x-icon" href="/media/logos/spud.svg">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://necolas.github.io/normalize.css/8.0.1/normalize.css">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200">
    <link rel="stylesheet" href="/css/main.css">
    <script src="https://kit.fontawesome.com/6006becb07.js" crossorigin="anonymous"></script>
</head>

<body>
    <main>
        <aside class="sidebar">
            <div class="sidebar-header">
                <img src="/media/logos/spud.svg" alt="logo">
                <h2>Spud</h2>
            </div>
            <ul class="sidebar-links">
                <h4>
                    <span>Main</span>
                    <div class="menu-separator"></div>
                </h4>
                <li><a href="#dashboard"><span class="material-symbols-outlined">dashboard</span>Dashboard</a></li>
                <li><a href="#docs"><span class="material-symbols-outlined">description</span>Documentation</a></li>
                <h4>
                    <span>Account</span>
                    <div class="menu-separator"></div>
                </h4>
                <li><a id="login-btn" onclick="login()"><span class="material-symbols-outlined">login</span>Login</a>
                </li>
            </ul>
            <!-- <div class="user-account">
                <div class="user-profile">
                    <img src="/media/discord pfp.png" alt="Profile Image">
                    <div class="user-detail">
                        <h3>Login</h3>
                        <span></span>
                    </div>
                </div>
            </div> -->
        </aside>
        <iframe id="content-frame" src="/iFrames/html/docs.html" title="content"></iframe>
    </main>
    <script>
        async function urlExists(url) {
            try {
                const response = await fetch(url, { method: 'HEAD' });
                return response.ok;
            } catch {
                return false;
            }
        }

        async function login() {
            window.location.href = 'https://api.jaimytuin.com/login'; // Update with your backend URL
        }

        async function checkLoginStatus() {
            try {
                const response = await fetch('https://api.jaimytuin.com/user', { credentials: 'include' });
                if (response.ok) {
                    return true;
                } else {
                    return false;
                }
            } catch {
                return false;
            }
        }

        // Function to update the iframe source based on the URL hash
        async function updateIframeSrc() {
            const isLoggedIn = await checkLoginStatus();
            if (isLoggedIn) {
                window.location.href = '/dashboard';
            } else {
                const hash = window.location.hash.substring(1); // Remove the '#' from the hash
                const iframe = document.getElementById('content-frame');
                const pages = {
                    '': '/iFrames/html/loginMsg.html',
                    'dashboard': '/iFrames/html/loginMsg.html',
                    'docs': '/iFrames/html/docs.html',
                };

                const pageUrl = pages[hash] || '/iFrames/html/404.html';

                iframe.src = pageUrl;
            }
        }

        // Update the iframe source on page load based on the initial URL hash
        updateIframeSrc();

        // Update the iframe source when the hash changes
        window.addEventListener('hashchange', updateIframeSrc);
    </script>
</body>

</html>